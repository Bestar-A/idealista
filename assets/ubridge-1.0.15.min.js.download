(function(c,d){typeof exports=="object"&&typeof module<"u"?module.exports=d():typeof define=="function"&&define.amd?define(d):(c=typeof globalThis<"u"?globalThis:c||self,c.ubridge=d())})(this,function(){"use strict";function c(n){return n?n.split(","):[]}const d={addConsents(n){var e,t;n&&Object.assign(n,{cmp_purposes:c((e=window==null?void 0:window.didomiState)==null?void 0:e.didomiPurposesConsent),cmp_vendors:c((t=window==null?void 0:window.didomiState)==null?void 0:t.didomiVendorsConsent)})}};let k=1;const g=[];function p(){g.forEach(n=>n())}function w(n,e){return{id:k++,type:n,info:e}}function a(n,e){return w(`--markup-- ${n}`,{datalayer:e})}function r(n){return w(`--load-- ${n}`)}function h(){return new Error().stack.replaceAll("Error","").split("at ").reverse().map(t=>t.trim()).reduce((t,i)=>`${t?t+`
`:""}${i}`,"")}const s={state:[],info(n){if(n){const e=this.state.find(t=>t.id===n);console.log(`| ${e.id} | ${e.type} |`),console.log("---- trace ----"),console.log(e.trace),console.log("---- info ----"),console.log(e.info)}else console.log(this.state)},log(n){(window.location.host.includes(".ac")||window.location.host.includes(".ag"))&&this.state.push({...n,trace:h()})}};function m(n){const e=n.view.bind(n),t=n.link.bind(n),i=n.track.bind(n);return Object.assign(n,s,{view(o){d.addConsents(o),s.log(a("view",o)),e(o)},link(o){d.addConsents(o),s.log(a("link",o)),t(o)},track(o,l){d.addConsents(l),s.log(a("track",l)),setTimeout(function(){i(o,l)},0)}})}let f=!1;const v={get(){return new Promise(n=>{f?n(window.utag):(s.log(r("fetching utag")),window.utag=void 0,function(e,t,i,o){e=window.utagPath,t=document,i="script",o=t.createElement(i),o.onload=function(){s.log(r("loaded utag")),f=!0,n(m(window.utag)),p()},o.src=e,o.type="text/java"+i,o.defer=!0,e=t.getElementsByTagName(i)[0],e.parentNode.insertBefore(o,e)}())})}},u=()=>(window.utag_cfg_ovrd={noview:!0},v);function C(){const n=u();window.utag=Object.assign({},{view(e){this.log(r("ask utag from view")),n.get().then(t=>t.view(e))},link(e){this.log(r("ask utag from link")),n.get().then(t=>t.link(e))},track(e,t){this.log(r("ask utag from track")),n.get().then(i=>i.track(e,t))}},s),window.addEventListener("load",()=>{window.ubridgeAutoView&&window.utag_data&&(s.log(r("on auto view")),window.utag.view(window.utag_data))}),window.idealistaUtag={onInit(e){s.log(r("on init")),window.utag?e():g.push(e)}}}return C(),()=>({track(n,e){u().get().then(t=>t.track(n,e))},view(n){u().get().then(e=>e.view(n))},link(n){u().get().then(e=>e.link(n))}})});
